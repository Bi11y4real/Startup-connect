<%- include('../../partials/header') %>

<div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md mx-auto">
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-center mb-6">Collaborate with <%= project.title %></h2>
            
            <form id="collaborationForm" class="space-y-6">
                <div>
                    <label for="role" class="block text-sm font-medium text-gray-700">Role</label>
                    <select id="role" name="role" required class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                        <option value="developer">Developer</option>
                        <option value="designer">Designer</option>
                        <option value="marketer">Marketer</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div>
                    <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
                    <textarea id="message" name="message" rows="4" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>

                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Send Request
                </button>
            </form>
        </div>
    </div>
</div>

<div id="errorMessage" class="hidden mb-4 p-4 text-red-700 bg-red-100 rounded-md"></div>
<div id="successMessage" class="hidden mb-4 p-4 text-green-700 bg-green-100 rounded-md"></div>

<script>
document.getElementById('collaborationForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const form = this;
    const submitButton = form.querySelector('button[type="submit"]');
    const errorDiv = document.getElementById('errorMessage');
    const successDiv = document.getElementById('successMessage');
    
    // Reset messages
    errorDiv.classList.add('hidden');
    successDiv.classList.add('hidden');
    
    // Disable submit button
    submitButton.disabled = true;
    submitButton.innerHTML = 'Sending...';
    
    const formData = new FormData(form);
    const projectId = '<%= project.id %>';
    const role = formData.get('role');
    const message = formData.get('message');

    try {
        const response = await fetch(`/projects/${projectId}/collaborate`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                role,
                message
            })
        });

        const result = await response.json();
        
        if (result.success) {
            successDiv.textContent = result.message || 'Collaboration request sent successfully!';
            successDiv.classList.remove('hidden');
            form.reset();
            
            // Redirect after a short delay
            setTimeout(() => {
                window.location.href = '/projects/' + projectId;
            }, 1500);
        } else {
            errorDiv.textContent = result.error || 'Failed to send collaboration request';
            errorDiv.classList.remove('hidden');
            submitButton.disabled = false;
            submitButton.textContent = 'Send Request';
        }
    } catch (error) {
        console.error('Error:', error);
        errorDiv.textContent = 'Failed to send collaboration request. Please check your connection and try again.';
        errorDiv.classList.remove('hidden');
        submitButton.disabled = false;
        submitButton.textContent = 'Send Request';
    }
});
</script>

<%- include('../../partials/footer') %>
